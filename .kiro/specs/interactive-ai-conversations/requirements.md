# Requirements Document - Interactive AI Conversations

## Introduction

This feature transforms Unbuilt from a one-shot analysis generator into an interactive AI advisor. Users can engage in follow-up conversations with the AI to refine analyses, ask clarifying questions, and explore ideas more deeply. This addresses the limitation where users receive static reports but naturally have questions like "Why is competitor X not a threat?" or "What if I target a different customer segment?"

## Glossary

- **Analysis_System**: The Unbuilt platform's AI-powered gap analysis engine
- **Conversation_Context**: The historical data from a specific gap analysis including the original query, results, scores, and all subsequent interactions
- **Follow_Up_Query**: A user's question or refinement request related to an existing analysis
- **AI_Response**: The system's contextual answer generated by the AI model using the conversation history
- **Conversation_Thread**: A complete sequence of interactions between the user and AI about a specific idea
- **Context_Window**: The amount of previous conversation history included when generating AI responses

## Requirements

### Requirement 1: Initiate Conversational Follow-Up

**User Story:** As a user who has received a gap analysis, I want to ask follow-up questions about the results, so that I can explore my idea more deeply without starting a new search.

#### Acceptance Criteria

1. WHEN a user views a completed gap analysis, THE Analysis_System SHALL display a conversational interface below the results
2. WHEN the conversational interface is displayed, THE Analysis_System SHALL include a text input field with placeholder text suggesting example questions
3. WHEN a user submits a Follow_Up_Query, THE Analysis_System SHALL maintain the Conversation_Context from the original analysis
4. WHEN processing a Follow_Up_Query, THE Analysis_System SHALL send both the original analysis data and the new question to the AI model
5. WHEN the AI generates a response, THE Analysis_System SHALL display it in a chat-like format with clear visual distinction between user questions and AI responses
6. WHEN multiple follow-up questions are asked, THE Analysis_System SHALL display them in chronological order as a Conversation_Thread
7. WHEN a user returns to a saved analysis, THE Analysis_System SHALL restore the complete Conversation_Thread

### Requirement 2: Contextual AI Responses

**User Story:** As a user asking follow-up questions, I want the AI to understand the context of my original analysis, so that I receive relevant and coherent answers.

#### Acceptance Criteria

1. WHEN generating an AI_Response, THE Analysis_System SHALL include the original search query in the Context_Window
2. WHEN generating an AI_Response, THE Analysis_System SHALL include all identified gaps and their scores in the Context_Window
3. WHEN generating an AI_Response, THE Analysis_System SHALL include the competitive analysis data in the Context_Window
4. WHEN generating an AI_Response, THE Analysis_System SHALL include the action plan phases in the Context_Window
5. WHEN a Conversation_Thread exceeds 10 exchanges, THE Analysis_System SHALL summarize earlier exchanges to maintain Context_Window efficiency
6. WHEN the AI cannot answer based on available context, THE Analysis_System SHALL acknowledge the limitation and suggest alternatives
7. WHEN generating responses, THE Analysis_System SHALL maintain consistency with the original analysis findings

### Requirement 3: Refinement and Re-Analysis

**User Story:** As a user exploring different angles of my idea, I want to refine my analysis based on new assumptions, so that I can see how changes affect the opportunity assessment.

#### Acceptance Criteria

1. WHEN a user requests a refinement (e.g., "What if I target EU market instead?"), THE Analysis_System SHALL identify it as a re-analysis request
2. WHEN a re-analysis is requested, THE Analysis_System SHALL prompt the user to confirm they want to generate a new analysis variant
3. WHEN the user confirms re-analysis, THE Analysis_System SHALL execute a new AI analysis with the modified parameters
4. WHEN re-analysis completes, THE Analysis_System SHALL display the new results alongside the original for comparison
5. WHEN multiple variants exist, THE Analysis_System SHALL allow users to switch between them
6. WHEN a variant is created, THE Analysis_System SHALL preserve the original analysis and its Conversation_Thread
7. WHEN displaying variants, THE Analysis_System SHALL clearly label which assumptions differ from the original

### Requirement 4: Suggested Follow-Up Questions

**User Story:** As a user who may not know what to ask, I want the system to suggest relevant follow-up questions, so that I can discover insights I might have missed.

#### Acceptance Criteria

1. WHEN an initial analysis completes, THE Analysis_System SHALL generate 3-5 suggested follow-up questions
2. WHEN generating suggestions, THE Analysis_System SHALL base them on the specific gaps and opportunities identified
3. WHEN a user clicks a suggested question, THE Analysis_System SHALL automatically submit it as a Follow_Up_Query
4. WHEN a Follow_Up_Query is answered, THE Analysis_System SHALL generate new suggested questions based on the conversation progress
5. WHEN suggestions are displayed, THE Analysis_System SHALL categorize them (e.g., "Market Validation", "Competitive Analysis", "Execution Strategy")
6. WHEN a user has asked multiple questions, THE Analysis_System SHALL avoid suggesting redundant questions
7. WHEN displaying suggestions, THE Analysis_System SHALL make them visually distinct from the conversation thread

### Requirement 5: Conversation Management

**User Story:** As a user with multiple analyses, I want to manage my conversation threads, so that I can organize and revisit important discussions.

#### Acceptance Criteria

1. WHEN viewing search history, THE Analysis_System SHALL indicate which analyses have active Conversation_Threads
2. WHEN a Conversation_Thread exists, THE Analysis_System SHALL display a preview of the last exchange
3. WHEN a user wants to continue a conversation, THE Analysis_System SHALL restore the full context immediately
4. WHEN a user wants to start fresh, THE Analysis_System SHALL provide an option to clear the Conversation_Thread while preserving the original analysis
5. WHEN exporting an analysis, THE Analysis_System SHALL include an option to include or exclude the Conversation_Thread
6. WHEN a Conversation_Thread is very long, THE Analysis_System SHALL provide a summary view with expandable details
7. WHEN sharing an analysis, THE Analysis_System SHALL allow users to choose whether to share the Conversation_Thread

### Requirement 6: Response Quality and Safety

**User Story:** As a user relying on AI advice, I want accurate and safe responses, so that I can trust the information for making business decisions.

#### Acceptance Criteria

1. WHEN generating AI_Responses, THE Analysis_System SHALL include confidence indicators for factual claims
2. WHEN the AI makes assumptions, THE Analysis_System SHALL explicitly state them in the response
3. WHEN discussing financial projections, THE Analysis_System SHALL include appropriate disclaimers
4. WHEN a user asks about topics outside the analysis scope, THE Analysis_System SHALL politely redirect to relevant aspects
5. IF a Follow_Up_Query contains inappropriate content, THE Analysis_System SHALL reject it with a clear explanation
6. WHEN generating responses, THE Analysis_System SHALL cite sources or data points when making specific claims
7. WHEN uncertainty exists, THE Analysis_System SHALL acknowledge it rather than providing potentially misleading information

### Requirement 7: Performance and Cost Management

**User Story:** As a platform operator, I want to manage AI API costs while maintaining good user experience, so that the feature remains sustainable.

#### Acceptance Criteria

1. WHEN a user submits a Follow_Up_Query, THE Analysis_System SHALL process it within 5 seconds for 90% of requests
2. WHEN managing Context_Window size, THE Analysis_System SHALL optimize token usage to minimize API costs
3. WHEN a free-tier user engages in conversations, THE Analysis_System SHALL limit follow-up questions to 5 per analysis
4. WHEN a Pro-tier user engages in conversations, THE Analysis_System SHALL allow unlimited follow-up questions
5. WHEN API rate limits are approached, THE Analysis_System SHALL queue requests and inform users of expected wait time
6. WHEN caching is possible, THE Analysis_System SHALL cache similar Follow_Up_Queries to reduce API calls
7. WHEN monitoring costs, THE Analysis_System SHALL track conversation API usage separately from initial analysis costs

## Non-Functional Requirements

### Performance
- Follow-up response time: <5 seconds (90th percentile)
- Context loading time: <1 second
- Conversation thread rendering: <500ms for 50 messages
- Concurrent conversations: Support 100+ simultaneous users

### Scalability
- Store unlimited conversation history per analysis
- Support conversations with 100+ exchanges
- Handle 10,000+ follow-up queries per day
- Efficient context window management for long conversations

### Security
- Validate and sanitize all user inputs
- Prevent prompt injection attacks
- Encrypt conversation data at rest
- Apply rate limiting per user tier

### Usability
- Mobile-friendly chat interface
- Clear visual hierarchy between questions and answers
- Keyboard shortcuts for power users (Enter to send, Shift+Enter for new line)
- Auto-scroll to new messages
- Loading indicators during AI processing

## Out of Scope

The following are explicitly NOT included in this feature:

- Voice input/output for conversations
- Multi-user conversations (team chat)
- AI-generated images or diagrams in responses
- Integration with external knowledge bases
- Conversation branching or forking
- Automated conversation summaries (beyond basic context management)
- Real-time typing indicators
- Conversation export to other formats (beyond PDF inclusion)

## Dependencies

### External Services
- Google Gemini API (or equivalent) with conversation support
- Token counting service for cost management
- Caching layer (Redis) for similar queries

### Internal Dependencies
- Existing gap analysis system
- User authentication and tier management
- Search history and favorites system
- Database schema supporting conversation storage

### Technical Requirements
- WebSocket or Server-Sent Events for real-time responses (optional enhancement)
- Efficient context serialization
- Token usage tracking and billing integration

## Success Metrics

### User Engagement
- Conversation adoption rate: >40% of analyses have follow-up questions
- Average questions per conversation: >3
- User satisfaction with AI responses: >4.2/5
- Return rate for users who use conversations: >75%

### Quality
- Response relevance score: >4.0/5 (user ratings)
- Response time: <5 seconds (90th percentile)
- Error rate: <2% of queries
- Inappropriate response rate: <0.1%

### Business
- Conversion impact: Conversation users convert to Pro at 2x rate
- Retention impact: Conversation users have 30% higher retention
- Cost per conversation: <$0.10 average
- API cost efficiency: >80% of queries use optimized context

## Timeline

**Estimated Duration:** 2-3 weeks

### Week 1: Core Infrastructure
- Conversation data model and storage
- Context window management
- Basic chat UI component

### Week 2: AI Integration
- Gemini API integration with context
- Response generation and formatting
- Suggested questions generation

### Week 3: Polish and Optimization
- Refinement and re-analysis features
- Performance optimization and caching
- Mobile optimization
- Testing and deployment

---

**Document Version:** 1.0  
**Last Updated:** October 21, 2025  
**Status:** Ready for Review
